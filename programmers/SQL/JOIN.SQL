-- 상품을 구매한 회원 비율 구하기
SELECT 
    YEAR(O.SALES_DATE) YEAR, -- DATE_FORMAT(O.SALES_DATE, '%Y') YEAR
    MONTH(O.SALES_DATE) MONTH, -- DATE_FORMAT(O.SALES_DATE, '%m') MONTH
    COUNT(DISTINCT O.USER_ID) PURCHASED_USERS,
    ROUND(
        COUNT(DISTINCT O.USER_ID) / 
        (SELECT COUNT(*) FROM USER_INFO WHERE YEAR(USER_INFO.JOINED) = 2021), 1) PUCHASED_RATIO
FROM ONLINE_SALE AS O
JOIN USER_INFO AS U ON O.USER_ID = U.USER_ID
WHERE YEAR(U.JOINED) = 2021 -- U.JOINED LIKE '2021%' / U.JOINED BETWEEN '2021-01-01' AND '2021-12-31'
GROUP BY YEAR, MONTH
ORDER BY MONTH ASC;

-- 상품 별 오프라인 매출 구하기
SELECT PRODUCT_CODE, SUM(O.SALES_AMOUNT * P.PRICE) AS SALES FROM
PRODUCT AS P
INNER JOIN OFFLINE_SALE AS O ON P.PRODUCT_ID = O.PRODUCT_ID
GROUP BY P.PRODUCT_CODE
ORDER BY SALES DESC, P.PRODUCT_CODE ASC

-- 없어진 기록 찾기
SELECT O.ANIMAL_ID, O.NAME
FROM ANIMAL_INS I
RIGHT JOIN ANIMAL_OUTS O ON I.ANIMAL_ID = O.ANIMAL_ID
WHERE I.ANIMAL_ID IS NULL